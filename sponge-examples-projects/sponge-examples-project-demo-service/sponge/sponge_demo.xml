<?xml version="1.0" encoding="UTF-8"?>
<sponge xmlns="http://sponge.openksavi.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://sponge.openksavi.org http://sponge.openksavi.org/schema/config.xsd">

    <properties>
        <!-- Set these properties via system properties in a servlet container environment! -->
        <!-- <property name="digits.home">digits</property> -->
        <!-- <property name="password.file">password.txt</property> -->

        <!-- The optional prediction probability threshold. -->
        <property name="predictionThreshold" variable="true">0.6</property>

        <property name="doodlesDir">${sponge.home}/data/doodles</property>
    </properties>

    <knowledgeBases>
        <knowledgeBase name="demo" displayName="Demo">
            <file>sponge_demo.py</file>
        </knowledgeBase>
        <knowledgeBase name="demoPlus" displayName="Demo plus">
            <file>sponge_demo_plus.py</file>
        </knowledgeBase>
        <knowledgeBase name="digits" displayName="Digits">
            <file>${digits.home}/actions/digits_common.py</file>
            <file>${digits.home}/actions/digits_predict.py</file>
            <file>sponge_demo_digits.py</file>
        </knowledgeBase>
        <knowledgeBase name="digitsLearn" displayName="Digits learn">
            <file>${digits.home}/actions/digits_common.py</file>
            <file>${digits.home}/actions/digits_learn.py</file>
        </knowledgeBase>
        <knowledgeBase name="engine" displayName="Engine">
            <file>classpath*:org/openksavi/sponge/restapi/server/engine_public_library.py</file>
        </knowledgeBase>
        <knowledgeBase name="admin" displayName="Admin">
            <file>classpath*:org/openksavi/sponge/restapi/server/engine_admin_library.py</file>
        </knowledgeBase>
        <knowledgeBase name="security" displayName="Security">
            <file>rest_api_security.py</file>
        </knowledgeBase>
    </knowledgeBases>

    <plugins>
        <plugin name="py4j" class="org.openksavi.sponge.py4j.ClientServerPy4JPlugin">
            <configuration>
                <facadeInterface>org.openksavi.sponge.tensorflow.ImageClassifierService</facadeInterface>
                <pythonScript>
                    <executable>${user.home}/tensorflow/bin/python3</executable>
                    <argument>digits_service.py</argument>
                    <!-- The model file and the temporary directory are specified relative to the Python workingDir. -->
                    <argument>--modelfile=../data/digits_model.h5</argument>
                    <argument>--workspacedir=../_workspace_</argument>
                    <workingDir>${digits.home}/python</workingDir>
                    <waitForPositiveLineRegexp>The service has started.</waitForPositiveLineRegexp>
                    <waitForNegativeLineRegexp>The service has failed to start.</waitForNegativeLineRegexp>
                    <outputRedirect>CONSUMER</outputRedirect>
                    <errorRedirect>CONSUMER</errorRedirect>
                </pythonScript>
            </configuration>
        </plugin>
    </plugins>
</sponge>

